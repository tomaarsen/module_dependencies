<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#2D2D2D" />
  
  <title>Home :: module_dependencies.module.module</title>
  
  <link rel="index" title="Index" href="../../../genindex.html"/>

  <link rel="stylesheet" href="../../../_static/css/nltk_theme.css"/>
  <link rel="stylesheet" href="../../../_static/css/custom.css"/>

  <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../_static/sphinx_highlight.js"></script>
  

  <script src="https://email.tl.fortawesome.com/c/eJxNjUEOgyAQAF8jR7Kw6wIHDh7sP1Cw2mgxgmn6-3JsMqc5zEQfE8dkxOY1KKMUOI3ACFKRJpSW2AAp7ontYIaxI6i7XPJVwyeVfCQ550Os3jLrGSNOLgbdAy6s0PBk2TFNjEbsfq31LB0OnX407pJa5v2faRadwSW63mn5KuLyR9j2tgx3zecanl-55R_-jjPs"></script> 
</head>

<body>
  <div id="nltk-theme-container">
    <header>
      <div id="logo-container">
          
          <h1>
            <a href="../../../index.html">Home</a>
          </h1>
          
      </div>
      <div id="project-container">
        
        <h1>Documentation</h1>
        
      </div>

      <a id="menu-toggle" class="fa fa-bars" aria-hidden="true"></a>

      <script type="text/javascript">
        $("#menu-toggle").click(function() {
          $("#menu-toggle").toggleClass("toggled");
          $("#side-menu-container").slideToggle(300);
        });
      </script>
    </header>

    <div id="content-container">

      <div id="side-menu-container">

        <div id="search" role="search">
        <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
            <input type="text" name="q" placeholder="Search" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
        </form>
</div>

        <div id="side-menu" role="navigation">
          
  
    
  
  
    <p class="caption" role="heading"><span class="caption-text">module_dependencies</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/module_dependencies.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api/module_dependencies.module.html">Module package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/module_dependencies.module.module.html">module.module module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/module_dependencies.module.session.html">module.session module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/module_dependencies.source.html">Source package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/module_dependencies.source.api.html">source.api module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/module_dependencies.source.factory.html">source.factory module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/module_dependencies.source.source.html">source.source module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/module_dependencies.source.visitor.html">source.visitor module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/module_dependencies.util.html">Util package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/module_dependencies.util.tokenize.html">util.tokenize module</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../py-modindex.html">Module Index</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/tomaarsen/module_dependencies">GitHub</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installing via <code class="docutils literal notranslate"><span class="pre">pip</span></code></a></li>
</ul>

  

        </div>

        
      </div>

      <div id="main-content-container">
        <div id="main-content" role="main">
          
  <h1>Source code for module_dependencies.module.module</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span><span class="p">,</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">lru_cache</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">cached_property</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">cached_property</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="nb">property</span><span class="p">(</span><span class="n">lru_cache</span><span class="p">()(</span><span class="n">f</span><span class="p">))</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">from</span> <span class="nn">module_dependencies.module.session</span> <span class="kn">import</span> <span class="n">ModuleSession</span>
<span class="kn">from</span> <span class="nn">module_dependencies.util.tokenize</span> <span class="kn">import</span> <span class="n">detokenize</span><span class="p">,</span> <span class="n">tokenize</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="Module"><a class="viewcode-back" href="../../../api/module_dependencies.module.module.html#module_dependencies.module.module.Module">[docs]</a><span class="k">class</span> <span class="nc">Module</span><span class="p">:</span>
<div class="viewcode-block" id="Module.__init__"><a class="viewcode-back" href="../../../api/module_dependencies.module.module.html#module_dependencies.module.module.Module.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">module</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">count</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;25000&quot;</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">lazy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">python</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">jupyter</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a Module instance that can be used to find</span>
<span class="sd">        which sections of a Python module are most frequently used.</span>

<span class="sd">        This class exposes the following methods::</span>

<span class="sd">            usage()</span>
<span class="sd">            nested_usage()</span>
<span class="sd">            repositories()</span>
<span class="sd">            plot()</span>
<span class="sd">            n_uses()</span>
<span class="sd">            n_files()</span>
<span class="sd">            n_repositories()</span>

<span class="sd">        ..</span>
<span class="sd">            TODO: Alert users of `alert`, output `limitHit`</span>
<span class="sd">            TODO: Something with percentages?</span>
<span class="sd">            TODO: Info on just one object, e.g.</span>
<span class="sd">            &gt;&gt;&gt; module.use(&quot;nltk.tokenize&quot;)</span>
<span class="sd">            &quot;802 occurrences out of 83530 (0.96%)&quot;</span>
<span class="sd">            TODO: Biggest repositories relying on some subsection.</span>
<span class="sd">                Perhaps an extension to `repositories()`?</span>
<span class="sd">                Add this to n_uses, n_files and n_repositories, too</span>

<span class="sd">        :param module: The name of a Python module of which to find</span>
<span class="sd">            the frequently used objects, e.g. `&quot;nltk&quot;`.</span>
<span class="sd">        :type module: str</span>
<span class="sd">        :param token: Sourcegraph API token to avoid rate-limiting 429 error</span>
<span class="sd">        :type token: str, optional</span>
<span class="sd">        :param count: The maximum number of times an import of `module`</span>
<span class="sd">            should be fetched. Roughly equivalent to the number of fetched</span>
<span class="sd">            files. Either an integer, a string representing an integer,</span>
<span class="sd">            or &quot;all&quot;, defaults to &quot;25000&quot;.</span>
<span class="sd">        :type count: Union[int, str], optional</span>
<span class="sd">        :param verbose: If True, set the logging level to INFO, otherwise to</span>
<span class="sd">            WARNING. True implies that there is some data printed to sys.out,</span>
<span class="sd">            while False makes the class quiet. Defaults to True.</span>
<span class="sd">        :type verbose: bool, optional</span>
<span class="sd">        :param lazy: If True, waits with fetching and parsing the data to when</span>
<span class="sd">            the data is required. Defaults to True.</span>
<span class="sd">        :type lazy: bool, optional</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span> <span class="o">=</span> <span class="n">module</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="n">count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="s2">&quot;10s&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">token</span>
        
        <span class="n">languages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">python</span><span class="p">:</span>
            <span class="n">languages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Python&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">jupyter</span><span class="p">:</span>
            <span class="n">languages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Jupyter Notebook&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">languages</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">languages</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">lazy</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span></div>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cached property of a Module, containing the parsed data from</span>
<span class="sd">        the SourceGraph API. This property lazily loads the data once upon request,</span>
<span class="sd">        and then parses it using `Source(...).dependencies()`.</span>

<span class="sd">        Example usage::</span>

<span class="sd">            &gt;&gt;&gt; from module_dependencies import Module</span>
<span class="sd">            &gt;&gt;&gt; module = Module(&quot;nltk&quot;, count=3)</span>
<span class="sd">            &gt;&gt;&gt; pprint(module.data, depth=1)</span>
<span class="sd">            {</span>
<span class="sd">                &#39;alert&#39;: None,</span>
<span class="sd">                &#39;cloning&#39;: [],</span>
<span class="sd">                &#39;elapsedMilliseconds&#39;: 573,</span>
<span class="sd">                &#39;limitHit&#39;: True,</span>
<span class="sd">                &#39;matchCount&#39;: 3,</span>
<span class="sd">                &#39;missing&#39;: [],</span>
<span class="sd">                &#39;repositoriesCount&#39;: 1,</span>
<span class="sd">                &#39;results&#39;: [...],</span>
<span class="sd">                &#39;timedout&#39;: []</span>
<span class="sd">            }</span>

<span class="sd">        :return: The cached, parsed SourceGraph API data.</span>
<span class="sd">        :rtype: Dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ModuleSession</span><span class="p">(</span><span class="n">token</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">)</span><span class="o">.</span><span class="n">fetch_and_parse</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">languages</span>
        <span class="p">)</span>

<div class="viewcode-block" id="Module.is_subsection_of"><a class="viewcode-back" href="../../../api/module_dependencies.module.module.html#module_dependencies.module.module.Module.is_subsection_of">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">is_subsection_of</span><span class="p">(</span><span class="n">var_one</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">var_two</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check whether `var_one` is a subsection of `var_two`. This means</span>
<span class="sd">        that `var_two` can be created by inserting strings into the tuple of</span>
<span class="sd">        `var_one`. For example, `var_two` as `(&#39;nltk&#39;, &#39;tokenize&#39;, &#39;word_tokenize&#39;)`</span>
<span class="sd">        can be created by inserting `&#39;tokenize&#39;` into a `var_one` as</span>
<span class="sd">        `(&#39;nltk&#39;, &#39;word_tokenize&#39;)`, so this function returns True.</span>

<span class="sd">        :param var_one: Tuple of strings representing the path to a Python</span>
<span class="sd">            object, e.g. `(&#39;nltk&#39;, &#39;word_tokenize&#39;)`.</span>
<span class="sd">        :type var_one: Tuple[str]</span>
<span class="sd">        :param var_two: Tuple of strings representing the path to a Python</span>
<span class="sd">            object, e.g. `(&#39;nltk&#39;, &#39;tokenize&#39;, &#39;word_tokenize&#39;)`.</span>
<span class="sd">        :type var_two: Tuple[str]</span>
<span class="sd">        :return: True if `var_one` is a subsection of `var_two`.</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">var_two</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">section</span> <span class="o">==</span> <span class="n">var_one</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="c1"># e.g. with (&#39;nltk&#39;, &#39;corpus&#39;, &#39;words&#39;) and (&#39;nltk&#39;, &#39;corpus&#39;, &#39;words&#39;, &#39;words&#39;),</span>
            <span class="c1"># TODO: False isnt really appropriate. This algorithm simply doesn&#39;t</span>
            <span class="c1"># work well with repeat words.</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">var_one</span><span class="p">)</span></div>

<div class="viewcode-block" id="Module.usage"><a class="viewcode-back" href="../../../api/module_dependencies.module.module.html#module_dependencies.module.module.Module.usage">[docs]</a>    <span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">usage</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">merge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cumulative</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a list of object-occurrence tuples, sorted by most to least frequent.</span>

<span class="sd">        Example usage::</span>

<span class="sd">            &gt;&gt;&gt; from module_dependencies import Module</span>
<span class="sd">            &gt;&gt;&gt; module = Module(&quot;nltk&quot;, count=&quot;3&quot;)</span>
<span class="sd">            &gt;&gt;&gt; module.usage()</span>
<span class="sd">            [(&#39;nltk.metrics.distance.edit_distance&#39;, 2),</span>
<span class="sd">            (&#39;nltk.tokenize.sent_tokenize&#39;, 1),</span>
<span class="sd">            (&#39;nltk.tokenize.treebank.TreebankWordDetokenizer&#39;, 1)]</span>

<span class="sd">        :param merge: Whether to attempt to merge e.g. `&quot;nltk.word_tokenize&quot;`</span>
<span class="sd">            into `&quot;nltk.tokenize.word_tokenize&quot;`. May give incorrect results</span>
<span class="sd">            for projects with &quot;compat&quot; folders, as the merging tends to prefer</span>
<span class="sd">            longer paths, e.g. `&quot;tensorflow.float32&quot;` will become</span>
<span class="sd">            `&quot;tensorflow.compat.v1.dtypes.float32&quot;` as opposed to just</span>
<span class="sd">            `&quot;tensorflow.dtypes.float32&quot;`. Defaults to True.</span>
<span class="sd">        :type merge: bool</span>
<span class="sd">        :return: A list of object-occurrence tuples, sorted by most to least frequent.</span>
<span class="sd">        :rtype: List[Tuple[str, int]]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># uses</span>
        <span class="c1"># frequency</span>

        <span class="k">def</span> <span class="nf">merge_one</span><span class="p">(</span><span class="n">usage</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Merge a list of similar tuples, combining on &quot;paths&quot; that likely</span>
<span class="sd">            refer to the same object, e.g. `&quot;nltk.word_tokenize&quot;` and</span>
<span class="sd">            `&quot;nltk.tokenize.word_tokenize&quot;`. `usage` is a list of potentially</span>
<span class="sd">            combinable objects.</span>

<span class="sd">            :param usage: A list of tuples, where the first element is a tuple</span>
<span class="sd">                of strings that represent a path to a Python object, e.g.</span>
<span class="sd">                `(&#39;nltk&#39;, &#39;word_tokenize&#39;)`, and the second element is how</span>
<span class="sd">                often that Python object occurs in a large collection of code.</span>
<span class="sd">                Each path in the tuple ends in the same token, and thus could</span>
<span class="sd">                refer to the same object.</span>
<span class="sd">            :type usage: List[Tuple[Tuple[str], int]]</span>
<span class="sd">            :return: `usage`, but the first element of each tuple is detokenized,</span>
<span class="sd">                i.e. converted back to a string, and paths that refer to the</span>
<span class="sd">                same element are merged.</span>
<span class="sd">            :rtype: List[Tuple[str, int]]</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">merged</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="c1"># Sort `usage` on longest to shortest paths</span>
            <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">occ</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">usage</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="c1"># Get the list of object/occurrence tuples that `obj` can expand to become</span>
                <span class="c1"># Note that in order to expand to something, it must have occurred more than once</span>
                <span class="n">options</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">(</span><span class="n">o_key</span><span class="p">,</span> <span class="n">o_occ</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">o_key</span><span class="p">,</span> <span class="n">o_occ</span> <span class="ow">in</span> <span class="n">merged</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">Module</span><span class="o">.</span><span class="n">is_subsection_of</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">o_key</span><span class="p">)</span> <span class="ow">and</span> <span class="n">o_occ</span> <span class="o">&gt;</span> <span class="mi">1</span>
                <span class="p">]</span>
                <span class="k">if</span> <span class="n">options</span><span class="p">:</span>
                    <span class="c1"># Get the most likely expansion, e.g.</span>
                    <span class="c1"># &quot;nltk.load&quot; can expand to &quot;nltk.data.load&quot;</span>
                    <span class="c1"># and &quot;nltk.parse.dependencygraph.DependencyGraph.load&quot;</span>
                    <span class="c1"># Then, we pick the one with the highest occurrence,</span>
                    <span class="c1"># which is likely &quot;nltk.data.load&quot;</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">merged</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="n">occ</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">merged</span><span class="p">[</span><span class="n">obj</span><span class="p">]</span> <span class="o">=</span> <span class="n">occ</span>
            <span class="k">return</span> <span class="p">[(</span><span class="n">detokenize</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="n">occ</span><span class="p">)</span> <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">occ</span> <span class="ow">in</span> <span class="n">merged</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>

        <span class="k">def</span> <span class="nf">merge_all</span><span class="p">(</span><span class="n">usage</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Merge a list of tuples, combining on &quot;paths&quot; that likely</span>
<span class="sd">            refer to the same object, e.g. `&quot;nltk.word_tokenize&quot;` and</span>
<span class="sd">            `&quot;nltk.tokenize.word_tokenize&quot;`.</span>

<span class="sd">            :param usage: A list of tuples, where the first element of</span>
<span class="sd">                each tuple is a string representing a path to a Python object,</span>
<span class="sd">                e.g. `&quot;nltk.word_tokenize&quot;`, and the second element of each</span>
<span class="sd">                tuple is the occurrence of that object in a large collection</span>
<span class="sd">                of code.</span>
<span class="sd">            :type usage: List[Tuple[str, int]]</span>
<span class="sd">            :return: `usage`, but with some merged tuples.</span>
<span class="sd">            :rtype: List[Tuple[str, int]]</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># Group usage data together, based on the last token in each object path</span>
            <span class="c1"># Merging can only occur within these groups.</span>
            <span class="n">grouped</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">occ</span> <span class="ow">in</span> <span class="n">usage</span><span class="p">:</span>
                <span class="n">obj_tok</span> <span class="o">=</span> <span class="n">tokenize</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                <span class="n">grouped</span><span class="p">[</span><span class="n">obj_tok</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">obj_tok</span><span class="p">,</span> <span class="n">occ</span><span class="p">))</span>

            <span class="c1"># Attempt to merge within a group</span>
            <span class="n">merged</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">grouped</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">merged</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">merge_one</span><span class="p">(</span><span class="n">group</span><span class="p">))</span>
            <span class="c1"># Sort the usage data from most to least occurring</span>
            <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">merged</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">cumulate</span><span class="p">(</span><span class="n">usage</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
            <span class="n">usage</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="p">{</span><span class="n">tokenize</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span> <span class="n">occ</span> <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">occ</span> <span class="ow">in</span> <span class="n">usage</span><span class="p">})</span>
            <span class="k">for</span> <span class="n">tok_obj</span><span class="p">,</span> <span class="n">occ</span> <span class="ow">in</span> <span class="n">usage</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tok_obj</span><span class="p">)):</span>
                    <span class="n">usage</span><span class="p">[</span><span class="n">tok_obj</span><span class="p">[:</span><span class="n">i</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">occ</span>
            <span class="n">usage</span> <span class="o">=</span> <span class="p">[(</span><span class="n">detokenize</span><span class="p">(</span><span class="n">tok_obj</span><span class="p">),</span> <span class="n">occ</span><span class="p">)</span> <span class="k">for</span> <span class="n">tok_obj</span><span class="p">,</span> <span class="n">occ</span> <span class="ow">in</span> <span class="n">usage</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
            <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">usage</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span>
            <span class="n">use</span>
            <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">use</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">][</span><span class="s2">&quot;dependencies&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">usage</span> <span class="o">=</span> <span class="n">counter</span><span class="o">.</span><span class="n">most_common</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">merge</span><span class="p">:</span>
            <span class="n">usage</span> <span class="o">=</span> <span class="n">merge_all</span><span class="p">(</span><span class="n">usage</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cumulative</span><span class="p">:</span>
            <span class="n">usage</span> <span class="o">=</span> <span class="n">cumulate</span><span class="p">(</span><span class="n">usage</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">usage</span></div>

<div class="viewcode-block" id="Module.nested_usage"><a class="viewcode-back" href="../../../api/module_dependencies.module.module.html#module_dependencies.module.module.Module.nested_usage">[docs]</a>    <span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">nested_usage</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">full_name</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">merge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cumulative</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a (recursive) dictionary of objects mapped to occurrence of that object,</span>
<span class="sd">        and the object&#39;s children.</span>

<span class="sd">        Example usage::</span>

<span class="sd">            &gt;&gt;&gt; from module_dependencies import Module</span>
<span class="sd">            &gt;&gt;&gt; module = Module(&quot;nltk&quot;, count=&quot;3&quot;)</span>
<span class="sd">            &gt;&gt;&gt; module.nested_usage()</span>
<span class="sd">            {</span>
<span class="sd">                &quot;nltk&quot;: {</span>
<span class="sd">                    &quot;occurrences&quot;: 4,</span>
<span class="sd">                    &quot;corpus&quot;: {</span>
<span class="sd">                        &quot;occurrences&quot;: 2,</span>
<span class="sd">                        &quot;stopwords&quot;: {</span>
<span class="sd">                            &quot;occurrences&quot;: 2,</span>
<span class="sd">                            &quot;words&quot;: {</span>
<span class="sd">                                &quot;occurrences&quot;: 2</span>
<span class="sd">                            }</span>
<span class="sd">                        }</span>
<span class="sd">                    },</span>
<span class="sd">                    &quot;tokenize&quot;: {</span>
<span class="sd">                        &quot;occurrences&quot;: 2,</span>
<span class="sd">                        &quot;sent_tokenize&quot;: {</span>
<span class="sd">                            &quot;occurrences&quot;: 1</span>
<span class="sd">                        },</span>
<span class="sd">                        &quot;treebank&quot;: {</span>
<span class="sd">                            &quot;occurrences&quot;: 1,</span>
<span class="sd">                            &quot;TreebankWordDetokenizer&quot;: {</span>
<span class="sd">                                &quot;occurrences&quot;: 1</span>
<span class="sd">                            }</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">        TODO: Optimize this by relying on usage() better for cumulative</span>

<span class="sd">        :param full_name: Whether each dictionary key should be the full path,</span>
<span class="sd">            e.g. `&quot;nltk.tokenize&quot;`, rather than just the right-most section.</span>
<span class="sd">            Defaults to False.</span>
<span class="sd">        :type full_name: bool</span>
<span class="sd">        :param merge: Whether to attempt to merge e.g. `&quot;nltk.word_tokenize&quot;`</span>
<span class="sd">            into `&quot;nltk.tokenize.word_tokenize&quot;`. May give incorrect results</span>
<span class="sd">            for projects with &quot;compat&quot; folders, as the merging tends to prefer</span>
<span class="sd">            longer paths, e.g. `&quot;tensorflow.float32&quot;` will become</span>
<span class="sd">            `&quot;tensorflow.compat.v1.dtypes.float32&quot;` as opposed to just</span>
<span class="sd">            `&quot;tensorflow.dtypes.float32&quot;`. Defaults to True.</span>
<span class="sd">        :type merge: bool</span>
<span class="sd">        :param cumulative: Whether to include usage counts of e.g.</span>
<span class="sd">            `&quot;nltk.tokenize.word_tokenize&quot;` into `&quot;nltk.tokenize&quot;` and</span>
<span class="sd">            `&quot;nltk&quot;` as well. Defaults to True.</span>
<span class="sd">        :param cumulative: bool</span>
<span class="sd">        :return: A dictionary mapping objects to how often that object occurred</span>
<span class="sd">            in the parsed source code.</span>
<span class="sd">        :rtype: Dict[str, Union[Dict, int]]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># nested_uses</span>
        <span class="c1"># nested_frequency</span>
        <span class="k">def</span> <span class="nf">recursive_add</span><span class="p">(</span>
            <span class="n">nested</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">obj_tup</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">occurrence</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">obj_tup</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">head</span> <span class="o">=</span> <span class="n">obj_tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">full_name</span> <span class="ow">and</span> <span class="n">prefix</span><span class="p">:</span>
                <span class="n">head</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">head</span>
            <span class="k">if</span> <span class="n">head</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nested</span><span class="p">:</span>
                <span class="n">nested</span><span class="p">[</span><span class="n">head</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;occurrences&quot;</span><span class="p">:</span> <span class="n">occurrence</span> <span class="k">if</span> <span class="n">cumulative</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj_tup</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cumulative</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj_tup</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">nested</span><span class="p">[</span><span class="n">head</span><span class="p">][</span><span class="s2">&quot;occurrences&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">occurrence</span>
            <span class="n">recursive_add</span><span class="p">(</span><span class="n">nested</span><span class="p">[</span><span class="n">head</span><span class="p">],</span> <span class="n">obj_tup</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">occurrence</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">head</span><span class="p">)</span>

        <span class="n">nested</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">occurrence</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="p">(</span><span class="n">merge</span><span class="o">=</span><span class="n">merge</span><span class="p">):</span>
            <span class="n">obj_tup</span> <span class="o">=</span> <span class="n">tokenize</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">recursive_add</span><span class="p">(</span><span class="n">nested</span><span class="p">,</span> <span class="n">obj_tup</span><span class="p">,</span> <span class="n">occurrence</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nested</span></div>

<div class="viewcode-block" id="Module.repositories"><a class="viewcode-back" href="../../../api/module_dependencies.module.module.html#module_dependencies.module.module.Module.repositories">[docs]</a>    <span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">repositories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a mapping of repository names to repository information</span>
<span class="sd">        that were fetched and parsed. Contains &quot;description&quot;, &quot;stars&quot;, &quot;isFork&quot; keys,</span>
<span class="sd">        plus a list of &quot;files&quot; with &quot;name&quot;, &quot;path&quot;, &quot;url&quot;, &quot;dependencies&quot; and</span>
<span class="sd">        &quot;parse_error&quot; fields. The &quot;parse_error&quot; field lists the error that was</span>
<span class="sd">        encountered when attempting to parse the file, e.g. &quot;SyntaxError&quot;.</span>
<span class="sd">        This might happen when a Python 2 file was fetched.</span>

<span class="sd">        Example usage::</span>

<span class="sd">            &gt;&gt;&gt; from module_dependencies import Module</span>
<span class="sd">            &gt;&gt;&gt; module = Module(&quot;nltk&quot;, count=&quot;3&quot;)</span>
<span class="sd">            &gt;&gt;&gt; module.repositories()</span>
<span class="sd">            {</span>
<span class="sd">                &quot;github.com/codelucas/newspaper&quot;: {</span>
<span class="sd">                    &quot;description&quot;: &quot;News, full-text, and article metadata extraction in Python 3. Advanced docs:&quot;,</span>
<span class="sd">                    &quot;stars&quot;: 11224,</span>
<span class="sd">                    &quot;isFork&quot;: false,</span>
<span class="sd">                    &quot;files&quot;: [</span>
<span class="sd">                        {</span>
<span class="sd">                            &quot;name&quot;: &quot;download_corpora.py&quot;,</span>
<span class="sd">                            &quot;path&quot;: &quot;download_corpora.py&quot;,</span>
<span class="sd">                            &quot;url&quot;: &quot;/github.com/codelucas/newspaper/-/blob/download_corpora.py&quot;,</span>
<span class="sd">                            &quot;dependencies&quot;: [</span>
<span class="sd">                                &quot;nltk.download&quot;</span>
<span class="sd">                            ],</span>
<span class="sd">                            &quot;parse_error&quot;: null</span>
<span class="sd">                        },</span>
<span class="sd">                        {</span>
<span class="sd">                            &quot;name&quot;: &quot;nlp.py&quot;,</span>
<span class="sd">                            &quot;path&quot;: &quot;newspaper/nlp.py&quot;,</span>
<span class="sd">                            &quot;url&quot;: &quot;/github.com/codelucas/newspaper/-/blob/newspaper/nlp.py&quot;,</span>
<span class="sd">                            &quot;dependencies&quot;: [</span>
<span class="sd">                                &quot;nltk.data.load&quot;</span>
<span class="sd">                            ],</span>
<span class="sd">                            &quot;parse_error&quot;: null</span>
<span class="sd">                        },</span>
<span class="sd">                        {</span>
<span class="sd">                            &quot;name&quot;: &quot;text.py&quot;,</span>
<span class="sd">                            &quot;path&quot;: &quot;newspaper/text.py&quot;,</span>
<span class="sd">                            &quot;url&quot;: &quot;/github.com/codelucas/newspaper/-/blob/newspaper/text.py&quot;,</span>
<span class="sd">                            &quot;dependencies&quot;: [</span>
<span class="sd">                                &quot;nltk.stem.isri.ISRIStemmer&quot;,</span>
<span class="sd">                                &quot;nltk.tokenize.wordpunct_tokenize&quot;</span>
<span class="sd">                            ],</span>
<span class="sd">                            &quot;parse_error&quot;: null</span>
<span class="sd">                        }</span>
<span class="sd">                    ]</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">        :return: A mapping of repositories</span>
<span class="sd">        :rtype: Dict[str, Dict[str, Any]]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">obj</span><span class="p">:</span>
            <span class="n">tok_obj</span> <span class="o">=</span> <span class="n">tokenize</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">objects</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">potential_obj</span>
                <span class="k">for</span> <span class="n">potential_obj</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="p">(</span><span class="n">merge</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cumulative</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">Module</span><span class="o">.</span><span class="n">is_subsection_of</span><span class="p">(</span><span class="n">tok_obj</span><span class="p">,</span> <span class="n">tokenize</span><span class="p">(</span><span class="n">potential_obj</span><span class="p">))</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">objects</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;No instance of </span><span class="si">{</span><span class="n">obj</span><span class="si">!r}</span><span class="s2"> was found in the fetched files!&quot;</span><span class="p">,</span>
                    <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="n">projects</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">]:</span>
            <span class="c1"># Add this result if we want all results,</span>
            <span class="c1"># or if this result contains dependencies that match `obj`</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span> <span class="ow">or</span> <span class="nb">set</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">][</span><span class="s2">&quot;dependencies&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">objects</span><span class="p">):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;repository&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;repository&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">projects</span><span class="p">:</span>
                    <span class="n">projects</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">projects</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;repository&quot;</span><span class="p">],</span> <span class="s2">&quot;files&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">]]}</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="nb">sorted</span><span class="p">(</span>
                <span class="n">projects</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">project</span><span class="p">:</span> <span class="n">project</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;stars&quot;</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Module.plot"><a class="viewcode-back" href="../../../api/module_dependencies.module.module.html#module_dependencies.module.module.Module.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">merge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">max_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
        <span class="n">transparant</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Display a plotly Sunburst plot showing the frequency of use</span>
<span class="sd">        of different sections of this module.</span>

<span class="sd">        :param merge: Whether to attempt to merge e.g. `&quot;nltk.word_tokenize&quot;`</span>
<span class="sd">            into `&quot;nltk.tokenize.word_tokenize&quot;`. May give incorrect results</span>
<span class="sd">            for projects with &quot;compat&quot; folders, as the merging tends to prefer</span>
<span class="sd">            longer paths, e.g. `&quot;tensorflow.float32&quot;` will become</span>
<span class="sd">            `&quot;tensorflow.compat.v1.dtypes.float32&quot;` as opposed to just</span>
<span class="sd">            `&quot;tensorflow.dtypes.float32&quot;`. Defaults to True.</span>
<span class="sd">        :type merge: bool</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>

        <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="n">nested_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">tok_obj</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Recursively apply elements from `tok_obj` as keys in `nested_dict`,</span>
<span class="sd">            and then gather the `occurrences`.</span>

<span class="sd">            :param nested_dict: A dictionary with nested usages, generally taken</span>
<span class="sd">                from the `nested_usage` method.</span>
<span class="sd">            :type nested_dict: Dict</span>
<span class="sd">            :param tok_obj: A tuple of strings representing a path to a Python path.</span>
<span class="sd">            :type tok_obj: Tuple[str]</span>
<span class="sd">            :return: The occurrence of the object represented by `tok_obj`</span>
<span class="sd">                in `nested_dict`.</span>
<span class="sd">            :rtype: int</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tok_obj</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">nested_dict</span><span class="p">[</span><span class="s2">&quot;occurrences&quot;</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">get_value</span><span class="p">(</span><span class="n">nested_dict</span><span class="p">[</span><span class="n">tok_obj</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">tok_obj</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

        <span class="n">usage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="p">(</span><span class="n">merge</span><span class="o">=</span><span class="n">merge</span><span class="p">)</span>
        <span class="n">nested_usage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nested_usage</span><span class="p">(</span><span class="n">merge</span><span class="o">=</span><span class="n">merge</span><span class="p">)</span>

        <span class="n">objects</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">usage</span><span class="p">:</span>
            <span class="n">tok_obj</span> <span class="o">=</span> <span class="n">tokenize</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">objects</span> <span class="o">|=</span> <span class="p">{</span>
                <span class="p">(</span><span class="n">detokenize</span><span class="p">(</span><span class="n">tok_obj</span><span class="p">[:</span><span class="n">i</span><span class="p">]),</span> <span class="n">tok_obj</span><span class="p">[:</span><span class="n">i</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tok_obj</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">}</span>

        <span class="n">full_objects</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;obj&quot;</span><span class="p">:</span> <span class="n">obj</span><span class="p">,</span> <span class="s2">&quot;tok&quot;</span><span class="p">:</span> <span class="n">tok_obj</span><span class="p">,</span> <span class="s2">&quot;val&quot;</span><span class="p">:</span> <span class="n">get_value</span><span class="p">(</span><span class="n">nested_usage</span><span class="p">,</span> <span class="n">tok_obj</span><span class="p">)}</span>
            <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">tok_obj</span> <span class="ow">in</span> <span class="n">objects</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">threshold</span><span class="p">:</span>
            <span class="n">full_objects</span> <span class="o">=</span> <span class="p">[</span><span class="n">fobj</span> <span class="k">for</span> <span class="n">fobj</span> <span class="ow">in</span> <span class="n">full_objects</span> <span class="k">if</span> <span class="n">fobj</span><span class="p">[</span><span class="s2">&quot;val&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">limit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sorted_fobjs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
                <span class="n">full_objects</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">fobj</span><span class="p">:</span> <span class="n">fobj</span><span class="p">[</span><span class="s2">&quot;val&quot;</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="n">limit_value</span> <span class="o">=</span> <span class="n">sorted_fobjs</span><span class="p">[</span><span class="n">limit</span><span class="p">][</span><span class="s2">&quot;val&quot;</span><span class="p">]</span>
            <span class="n">full_objects</span> <span class="o">=</span> <span class="p">[</span><span class="n">fobj</span> <span class="k">for</span> <span class="n">fobj</span> <span class="ow">in</span> <span class="n">full_objects</span> <span class="k">if</span> <span class="n">fobj</span><span class="p">[</span><span class="s2">&quot;val&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">limit_value</span><span class="p">]</span>

        <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;ids&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">fobj</span><span class="p">[</span><span class="s2">&quot;obj&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">fobj</span> <span class="ow">in</span> <span class="n">full_objects</span><span class="p">],</span>
            <span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">fobj</span><span class="p">[</span><span class="s2">&quot;tok&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">fobj</span> <span class="ow">in</span> <span class="n">full_objects</span><span class="p">],</span>
            <span class="s2">&quot;parents&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">detokenize</span><span class="p">(</span><span class="n">fobj</span><span class="p">[</span><span class="s2">&quot;tok&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">fobj</span> <span class="ow">in</span> <span class="n">full_objects</span><span class="p">],</span>
            <span class="s2">&quot;values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">fobj</span><span class="p">[</span><span class="s2">&quot;val&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">fobj</span> <span class="ow">in</span> <span class="n">full_objects</span><span class="p">],</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span>
                <span class="n">go</span><span class="o">.</span><span class="n">Sunburst</span><span class="p">(</span>
                    <span class="o">**</span><span class="n">parameters</span><span class="p">,</span>
                    <span class="n">branchvalues</span><span class="o">=</span><span class="s2">&quot;total&quot;</span><span class="p">,</span>
                    <span class="n">insidetextorientation</span><span class="o">=</span><span class="s2">&quot;radial&quot;</span><span class="p">,</span>
                    <span class="n">maxdepth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">layout</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
                    <span class="n">paper_bgcolor</span><span class="o">=</span><span class="s2">&quot;rgba(0,0,0,0)&quot;</span> <span class="k">if</span> <span class="n">transparant</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">margin</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;l&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">parameters</span></div>

<div class="viewcode-block" id="Module.n_uses"><a class="viewcode-back" href="../../../api/module_dependencies.module.module.html#module_dependencies.module.module.Module.n_uses">[docs]</a>    <span class="k">def</span> <span class="nf">n_uses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the number of uses of the module.</span>

<span class="sd">        Example usage::</span>

<span class="sd">            &gt;&gt;&gt; from module_dependencies import Module</span>
<span class="sd">            &gt;&gt;&gt; module = Module(&quot;nltk&quot;, count=&quot;100&quot;)</span>
<span class="sd">            &gt;&gt;&gt; module.n_uses()</span>
<span class="sd">            137</span>

<span class="sd">        :return: The number of uses, i.e. the number of times</span>
<span class="sd">            `self.module` was used in the fetched files.</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">obj</span><span class="p">:</span>
            <span class="n">tok_obj</span> <span class="o">=</span> <span class="n">tokenize</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">objects</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">potential_obj</span>
                <span class="k">for</span> <span class="n">potential_obj</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="p">(</span><span class="n">merge</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cumulative</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">Module</span><span class="o">.</span><span class="n">is_subsection_of</span><span class="p">(</span><span class="n">tok_obj</span><span class="p">,</span> <span class="n">tokenize</span><span class="p">(</span><span class="n">potential_obj</span><span class="p">))</span>
            <span class="p">}</span>
            <span class="c1"># print(objects)</span>
            <span class="n">usages</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="p">(</span><span class="n">merge</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cumulative</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
            <span class="c1"># print([usages[potential_obj] for potential_obj in objects])</span>
            <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">usages</span><span class="p">[</span><span class="n">potential_obj</span><span class="p">]</span> <span class="k">for</span> <span class="n">potential_obj</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">occ</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">occ</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="p">(</span><span class="n">merge</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cumulative</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span></div>

<div class="viewcode-block" id="Module.n_files"><a class="viewcode-back" href="../../../api/module_dependencies.module.module.html#module_dependencies.module.module.Module.n_files">[docs]</a>    <span class="k">def</span> <span class="nf">n_files</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the number of files fetched.</span>

<span class="sd">        Example usage::</span>

<span class="sd">            &gt;&gt;&gt; from module_dependencies import Module</span>
<span class="sd">            &gt;&gt;&gt; module = Module(&quot;nltk&quot;, count=&quot;100&quot;)</span>
<span class="sd">            &gt;&gt;&gt; module.n_files()</span>
<span class="sd">            100</span>

<span class="sd">        :return: The number of fetched files in which `self.module` was</span>
<span class="sd">            imported. Generally equivalent or similar to `count` if it</span>
<span class="sd">            was provided.</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="Module.n_repositories"><a class="viewcode-back" href="../../../api/module_dependencies.module.module.html#module_dependencies.module.module.Module.n_repositories">[docs]</a>    <span class="k">def</span> <span class="nf">n_repositories</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the number of repositories fetched.</span>

<span class="sd">        Example usage::</span>

<span class="sd">            &gt;&gt;&gt; from module_dependencies import Module</span>
<span class="sd">            &gt;&gt;&gt; module = Module(&quot;nltk&quot;, count=&quot;100&quot;)</span>
<span class="sd">            &gt;&gt;&gt; module.n_repositories()</span>
<span class="sd">            52</span>

<span class="sd">        TODO: Exclude errorred code</span>

<span class="sd">        :return: The number of fetched repositories in which `self.module`</span>
<span class="sd">            was imported.</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;repositoriesCount&quot;</span><span class="p">]</span></div></div>
</pre></div>

        </div>
      </div>

    </div>

<footer>
    <div id="footer-info">
        <ul id="build-details">
            

            

            
        </ul>

        
            <div id="copyright">
                &copy; 2021, Tom Aarsen
            </div>
        

        <div id="credit">
            created with <a href="http://sphinx-doc.org/">Sphinx</a> and <a href="https://github.com/tomaarsen/nltk_theme">NLTK Theme</a>
        </div>
    </div>
</footer> 

</div>

</body>
</html>